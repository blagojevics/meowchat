[phases.build]
cmds = [
  "echo 'BUILDING WITH NIXPACKS - USING NPM'",
  "npm install",
  "export NODE_ENV=production",
  "rm -rf dist",
  "npm run build -- --mode production --config vite.config.js",
  "echo 'BUILD COMPLETE - DIST FOLDER:'",
  "ls -la dist/",
  "echo 'INDEX.HTML CONTENT:'",
  "head -20 dist/index.html",
  "echo 'CHECKING IF BUILD SUCCEEDED:'",
  "grep -q 'assets/' dist/index.html && echo 'SUCCESS: Production assets found' || (echo 'FAILURE: Dev paths found' && exit 1)"
]

[phases.start]
cmd = "echo 'STARTING EXPRESS SERVER' && node server.js"

[variables]
NODE_ENV = "production"

[providers]
node = "18"